<style>
html {
	position: relative;
	min-height: 100%;
}
body {
	background: #eee;
	font-family: helvetica, serif;
	font-size: 13px;
	margin: 0; padding: 0;
	margin-bottom: 60px;
	color: #555;
	min-width: 400px;
}

.header {
	position: fixed;
	top: 0;
	width: 100%;
	padding: 15px 20px;
	background: #565fa2;
	color: white;
	z-index: 1;
}

.sitename {
	font-size: 20px;
	text-decoration: none;
	color: white;
}
.sitename a:visited {color: white;}

.player {
	background: rgba(20, 20, 20, 0.3);
	font-size: 15px;
    position: absolute;
    top: 10px;
    bottom: 10px;
    right: 60px;
    left: 200px;
	padding: 8px 20px;
	border-radius: 5px;
	cursor: pointer;
}
.player-pause {
	position: absolute;
	margin-top: -2px;
	cursor: pointer;
}
.player-title {
	display: inline-block;
	position: absolute;
	right: 100px;
    left: 50px;
	margin-left: 5%;
	overflow: hidden;
	text-overflow: ellipsis;
    white-space: nowrap;
}
.player-time, .player-volume_wrap {
	float: right;
}

.player-progress {
	position: absolute;
	top: 0; left: 0;
	background: #343858;
	height: 100%;
	width: 0%;
	z-index: -1;
	border-radius: 5px;
	animation-duration: 1s;
}

.player-volume {
	appearance: none;
	-webkit-appearance: none;
	transform: rotate(270deg);
	outline: none;
	width: 33px;
	height: 100%;
	margin: 0px;
	background: #343858;
	cursor: pointer;
}
.player-volume::-webkit-slider-thumb {
	-webkit-appearance: none;
    width: 10px;
    height: 100%;
	background-color: #565fa2;
	border: solid black 0.5px;
}

.main {
	margin: 0 auto;
	margin-top: 75px;
	padding: 0 2%;
	text-align: center;
}



.input {
	margin-top: 5px;
	font-size: 1.2em;
}
.input-item {
	width: 50%;
	margin: -2px;
	height: 50px;
	display: inline-block !important;
	font-size: 1.1em;
}
#DOM_next_day_btn {
	width: 100%;
	padding: 20px;
	margin-top: 5px;
	font-size: 1.2em;
	font-weight: bold;
}



.songs {
	margin-top: 20px;
}

.item {
	position: relative;
	display: block;
	padding: 10px 15px;
	margin-bottom: -1px;
	background-color: #ffffff;
	border: 1px solid #ecf0f1;
}

.item-playing {
	background-color: #cacbf8;
}

.splitter {
	margin-top: 18px;
    background: #565fa2;
    color: white;
	border-radius: 5px 5px 0 0;
}
.splitter-day {
    font-weight: bold;
    margin-top: 25px;
	border-radius: 5px;
}



.time {
	float: left;
	margin-top: -3px;
	padding: 3px 7px;
	font-family: DaysRegular, Arial, "Helvetica CY", "Nimbus Sans L", sans-serif;
	font-size: 13px;
	font-weight: bold;
	text-align: center;
	background-color: #e5e3ff;
	border-radius: 5px;
}

.casttitle {

}

.artist {
	font-weight: bold;
	margin-right: 1%;
}

.title {
	margin-left: 1%;
}


.play-btn {
	padding: 3px 7px;
	font-size: 13px;
	font-weight: bold;
	color: #ffffff;
	background-color: #2c3e50;
	border-radius: 10px;
	float: right;
	line-height: 1;
	cursor: pointer;
}
.play:before {
	content: '‚ñ∂';
}
.pause:before {
	content: '‚ùö‚ùö';
}


.foot {
  position: absolute;
  bottom: 0;
  width: 100%;
  line-height: 40px;
}
.foot a:visited {color: black;}

.hidden {visibility: hidden;}
button:hover {background-color: #c6c8de;}
a:link, a:visited, a:active { text-decoration: none; }

.rotate {	animation: spin 1s linear 0s infinite; display: inline-block;} @keyframes spin { 	from { transform:rotate(0deg); } 	to { transform:rotate(360deg); } }

.para_num-1 {background: #4fc3f7;}
.para_num-2 {background: #29b6f6;}
.para_num-3 {background: #03a9f4;}
.para_num-4 {background: #039be5;}
.para_num-5 {background: #6a76cc;}

</style>


<body>
<audio id="player" ontimeupdate="playerUpdateProgress()" 
	   onpause="playerOnPause()" onplay="playerOnPlay()"></audio>
<div class="header">
	<span class="sitename"><a href="http://t.me/kpiradio_bot">KPIRADIOBOT</a></span>
	<div id="DOMplayer" class="player hidden" onclick="playerProgress(event, this)">
		<div class="player-progress" id="playerprogressbar"></div>
		<span class="player-pause play" id="playerpause" onclick="playerPlayPause()"></span>
		<span class="player-title" id="playertitle">Lol - kek</span>
		<span class="player-volume_wrap"><input type="range" class="player-volume" oninput="playerVolume(this.value)"></span>
		<span class="player-time" id="playertime">14:88</span>
	</div>
</div>
<div class="main">
	<div class="input">
		<input class="item input-item" id="DOM_date" required onchange="search()" type="date" min="2018-08-21">
		<button class="item input-item" onclick="search()" style="top: 1px;">–ü–æ–∏—Å–∫ üîé</button>
	</div>
	<div class="songs" >
		<div id="DOM_songs"></div>
		<button class="item hidden" onclick="search(true)" id="DOM_next_day_btn">–î–∞–ª—å—à–µ</button>
	</div>
</div>


<div class="foot"><marquee direction="right">
<span class="rotate">Âçê</span>
<a href='https://t.me/svinerus'>¬©svinerus</a>
<span class="rotate">Âçê</span>
</marquee></div>



</body>



<script>
	DOM_date = document.getElementById('DOM_date')
	DOM_songs = document.getElementById('DOM_songs')
	DOM_next_day_btn = document.getElementById('DOM_next_day_btn')

	DOM_player = document.getElementById('DOMplayer')
	DOM_player_progressbar = document.getElementById('playerprogressbar')
	DOM_player_btn = document.getElementById('playerpause')
	DOM_player_time = document.getElementById('playertime')
	DOM_player_title = document.getElementById('playertitle')
	
	var Curr_item_playing
	var Curr_day
	old_para_num = 0
	
    date_format = {
	  weekday: 'long',
      month: 'long',
      day: 'numeric',
    }

	
	init()
	function init() {
		today = date_yyyymmdd(new Date())
		DOM_date.value = today
		DOM_date.max = today
		player.volume = 0.5
		search()
	}

	function search(nextday=false) {
		if (!nextday) {
			date = DOM_date.value
			if (date == "") {
				alert('–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É')
				return
			}
			date = new Date(date)
			tableRemove()
		}
		else 
			date = new Date(date.getTime() - 1000*60*60*24)
		
		Curr_day = date
		
		res = ajax('getday', +date/1000)
		res = JSON.parse(res)

		tableInsert(res)
	}



	function tableInsert(res) {
		DOM_next_day_btn.classList.remove('hidden')
		full_html = getSongItemSplitter(true, +Curr_day)
		for (var i=0; i<res.length; i++) {
			track = res[i]
			html = getSongItem(track)
			full_html += html
		}
		DOM_songs.innerHTML += full_html


	}

	function getSongItem(item) {
        html = ''

        if (item.para_num != old_para_num) {
			old_para_num = item.para_num
            html += getSongItemSplitter(false, item.para_num)
		}
	    html += "<div class='item track'>" +
		"<span class='time'>"+date_hhmm(item.time_start)+" - "+date_hhmm(item.time_stop)+"</span>" +
		"<span class='casttitle'>" +
			"<span class='artist'>"+item.artist+"</span>" +
			"<span class='title'>"+item.title+"</span>" +
		"</span>" +
		"<span class='play-btn play' onclick=\"play('"+ item.path +"', '"+ item.artist +" - "+ item.title +"', this)\"></span>" +
		"</div>"

		return html
    }

    function getSongItemSplitter(isDay, data) {
		if (isDay) {
		    html = new Date(data).toLocaleString("ru", date_format)
		    return "<div class='item splitter splitter-day'>"+html+"</div>"
		}
		if (Curr_day.getDay() == 0) // –≤—Å
			if (data == 1)
				html = '–î–Ω–µ–≤–Ω–æ–π —ç—Ñ–∏—Ä'
			else {
				html = '–í–µ—á–µ—Ä–Ω–∏–π —ç—Ñ–∏—Ä'
				data = 5
			}
		else {
			if (data == 5) html = '–í–µ—á–µ—Ä–Ω–∏–π —ç—Ñ–∏—Ä'
			else html = '–ü–æ—Å–ª–µ ' + data + ' –ø–∞—Ä—ã'
		} 
		
		return "<div class='item splitter para_num-"+ data +"'>"+html+"</div>"
    }

	
	function play(path, title, element) {
		DOMplayer.classList.remove('hidden')
		if (!element.classList.contains('pause')) { //play
			if (Curr_item_playing) {
				playerOnPause()
				Curr_item_playing.classList.remove('item-playing')
			}
			Curr_item_playing = element.parentElement
			Curr_item_playing.classList.add('item-playing')
			player.src = '/history/play/' + path
			DOM_player_title.innerHTML = title			
			playerUpdateProgress()
			playerPlayPause(true)
		} else {								  //pause
			playerPlayPause(false)
		}		
	}
	
	function playerVolume(volume) {
		player.volume = volume / 100
	}

	function playerProgress(event, bar) {
		if (!player.duration) return;
		progress = event.layerX / bar.clientWidth
		player.currentTime = player.duration * progress
		playerUpdateProgress() 
	}

	function playerPlayPause(state=undefined) {
		if (state === undefined) {
			if (player.paused) player.play()
			else player.pause()
			event.stopPropagation();
		} else {
			if (state) player.play()
			else player.pause()
		}
	}

	function playerUpdateProgress() {
		DOM_player_progressbar.style.width = player.currentTime/player.duration*100 + '%'
	}

	function playerOnPause() {
		DOM_player_btn.classList.remove('pause')
		if (Curr_item_playing)
			Curr_item_playing.getElementsByClassName('play-btn')[0].classList.remove('pause')
	}
	
	function playerOnPlay() {
		DOM_player_btn.classList.add('pause')
		if (Curr_item_playing)
			Curr_item_playing.getElementsByClassName('play-btn')[0].classList.add('pause')
	}
	
	
	function tableRemove() {
		DOM_songs.innerHTML = '';
	}

	function date_yyyymmdd(date) {
		return date.toISOString().substring(0, 10)
	}
	function date_hhmm(date) {
		s = new Date(date*1000).toLocaleTimeString().substring(0, 5)
		if (s[4] == ':') s = '0' + s.substring(0, 4)
		return s
	}
	
	
	function ajax(url, data) {
		var xmlhttp = new XMLHttpRequest();
		xmlhttp.open("POST", 'history/' + url, false);
		xmlhttp.send(data);
		if(xmlhttp.status == 200) return xmlhttp.responseText;
	}
</script>


