<style>
html {
	position: relative;
	min-height: 100%;
}
body {
	background: #eee;
	font-family: helvetica, serif;
	font-size: 13px;
	margin: 0; padding: 0;
	margin-bottom: 60px;
	color: #555;
	min-width: 400px;
}

.header {
	padding: 15px 20px;
	background: #565fa2;
	color: white;
	font-size: 20px;
	margin-bottom: 20px;
}

.main {
	margin: 0 auto;
	padding: 0 2%;
	text-align: center;
}



.input {
	margin-top: 5px;
	font-size: 1.2em;
}
.input-item {
	width: 50%;
	margin: -2px;
	height: 50px;
	display: inline-block !important;
	font-size: 1.1em;
}
#DOM_next_day_btn {
	width: 100%;
	padding: 20px;
	margin-top: 5px;
	font-size: 1.2em;
	font-weight: bold;
	visibility: hidden;
}



.songs {
	margin-top: 20px;
}

.item {
	position: relative;
	display: block;
	padding: 10px 15px;
	margin-bottom: -1px;
	background-color: #ffffff;
	border: 1px solid #ecf0f1;
}

.splitter {
	margin-top: 18px;
    background: #565fa2;
    color: white;
	border-radius: 5px 5px 0 0;
}
.splitter-day {
    font-weight: bold;
    margin-top: 25px;
	border-radius: 5px;
}



.time {
	float: left;
	padding: 3px 7px;
	font-family: DaysRegular, Arial, "Helvetica CY", "Nimbus Sans L", sans-serif;
	font-size: 13px;
	font-weight: bold;
	text-align: center;
	background-color: #e5e3ff;
	border-radius: 5px;
}

.casttitle {

}

.artist {
	font-weight: bold;
	margin-right: 1%;
}

.title {
	margin-left: 1%;
}


.play {
	padding: 3px 7px;
	font-size: 13px;
	font-weight: bold;
	color: #ffffff;
	background-color: #2c3e50;
	border-radius: 10px;
	float: right;
	line-height: 1;
}



.foot {
  position: absolute;
  bottom: 0;
  width: 100%;
  line-height: 40px;
}


button:hover {
	background-color: #c6c8de;
}
.rotate {	animation: spin 1s linear 0s infinite; display: inline-block;} @keyframes spin { 	from { transform:rotate(0deg); } 	to { transform:rotate(360deg); } }

.para_num-1 {background: #4fc3f7;}
.para_num-2 {background: #29b6f6;}
.para_num-3 {background: #03a9f4;}
.para_num-4 {background: #039be5;}
.para_num-5 {background: #6a76cc;}

</style>


<body>
<div class="header">KPIRADIOBOT</div>
<div class="main">
	<div class="input">
		<input class="item input-item" id="DOM_date" required onchange="search()" type="date" min="2018-06-07T00:00">
		<button class="item input-item" onclick="search()" style="top: 1px;">–ü–æ–∏—Å–∫ üîé</button>
	</div>
	<div class="songs" >
		<div id="DOM_songs"></div>
		<button class="item" onclick="search(true)" id="DOM_next_day_btn">–î–∞–ª—å—à–µ</button>
	</div>
</div>



<div class="foot"><marquee direction="right">
<span class="rotate">Âçê</span>
<a href='https://t.me/svinerus'>¬©svinerus</a>
<span class="rotate">Âçê</span>
</marquee></div>



</body>



<script>
	DOM_date = document.getElementById('DOM_date')
	DOM_songs = document.getElementById('DOM_songs')
	DOM_next_day_btn = document.getElementById('DOM_next_day_btn')
	var Curr_day
	var Next_day
	old_para_num = 0
	
    date_format = {
	  weekday: 'long',
      month: 'long',
      day: 'numeric',
    }

	
	init()
	function init() {
		today = date_yyyymmdd(new Date())
		DOM_date.value = today
		DOM_date.max = today
		search()
	}

	function search(nextday=false) {
		if (!nextday) {
			date = DOM_date.value
			if (date == "") {
				alert('–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É')
				return
			}
			date = new Date(date)
			Next_day = new Date(date.getTime() - 1000*60*60*24)
			tableRemove()
		}
		else {
			date = Next_day
		}

		res = ajax('getday', +date/1000)
		res = JSON.parse(res)

		tableInsert(res, date)
	}



	function tableInsert(res, date) {
		Curr_day = date
		DOM_next_day_btn.style.visibility = 'visible';
		full_html = getSongItemSplitter(true, +date)
		for (var i=0; i<res.length; i++) {
			track = res[i]
			html = getSongItem(track)
			full_html += html
		}
		DOM_songs.innerHTML += full_html


	}

	function getSongItem(item) {
        html = ''

        if (item.para_num != old_para_num) {
			old_para_num = item.para_num
            html += getSongItemSplitter(false, item.para_num)
		}
	    html += "<div class='item track'>\
		<span class='time'>"+date_hhmm(item.time_start)+" - "+date_hhmm(item.time_stop)+"</span> \
		<span class='casttitle'> \
			<span class='artist'>"+item.artist+"</span> \
			<span class='title'>"+item.title+"</span> \
		</span> \
		<span class='play'>‚ñ∂</span> \
		</div>"

		return html
    }

    function getSongItemSplitter(isDay, data) {
		if (isDay) {
		    html = new Date(data).toLocaleString("ru", date_format)
		    return "<div class='item splitter splitter-day'>"+html+"</div>"
		}
		if (Curr_day.getDay() == 0) // –≤—Å
			if (data == 1)
				html = '–î–Ω–µ–≤–Ω–æ–π —ç—Ñ–∏—Ä'
			else {
				html = '–í–µ—á–µ—Ä–Ω–∏–π —ç—Ñ–∏—Ä'
				data = 5
			}
		else {
			if (data == 5) html = '–í–µ—á–µ—Ä–Ω–∏–π —ç—Ñ–∏—Ä'
			else html = '–ü–æ—Å–ª–µ ' + data + ' –ø–∞—Ä—ã'
		} 
		
		return "<div class='item splitter para_num-"+ data +"'>"+html+"</div>"
    }



	function tableRemove() {
		DOM_next_day_btn.style.visibility = 'hidden';
		DOM_songs.innerHTML = '';
	}

	function date_yyyymmdd(date) {
		return date.toISOString().substring(0, 10)
	}
	function date_hhmm(date) {
		s = new Date(date*1000).toLocaleTimeString().substring(0, 5)
		if (s[4] == ':') s = '0' + s.substring(0, 4)
		return s
	}
	
	
	function ajax(url, data) {
		var xmlhttp = new XMLHttpRequest();
		xmlhttp.open("POST", 'history/' + url, false);
		xmlhttp.send(data);
		if(xmlhttp.status == 200) return xmlhttp.responseText;
	}
</script>


